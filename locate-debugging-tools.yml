---
- name: Get Windows 10 SDK path
  win_reg_stat:
    path: HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows Kits\Installed Roots
    name: KitsRoot10
  register: sdk_info_10
- name: Get Windows 8.1 SDK path
  win_reg_stat:
    path: HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows Kits\Installed Roots
    name: KitsRoot81
  register: sdk_info_81
- name: Find SDK
  set_fact:
    sdk_info: "{{ sdk_info_10 if sdk_info_10.exists else sdk_info_81 }}"
- name: Get Debugging Tools path (x86)
  win_stat:
    path: "{{ sdk_info.value }}Debuggers\\x86"
  register: dbgtools_sdk_info_x86
  when: sdk_info.exists
- name: Get Debugging Tools legacy path (x86)
  win_stat:
    path: "%PROGRAMFILES%\\Debugging Tools For Windows"
  register: dbgtools_legacy_info_x86
- name: Find Debugging Tools Path (x86)
  set_fact:
    dbgtools_x86_path: "{{ dbgtools_legacy_info_x86.stat.path | default('') if dbgtools_sdk_info_x86 is skipped 
                           else dbgtools_sdk_info_x86.stat.path }}"
- name: Get Debugging Tools path (x64)
  win_stat:
    path: "{{ sdk_info.value }}Debuggers\\x64"
  register: dbgtools_sdk_info
  when: sdk_info.exists
- name: Get Debugging Tools legacy path (x64)
  win_stat:
    path: "%PROGRAMFILES%\\Debugging Tools For Windows (x64)"
  register: dbgtools_legacy_info
- name: Find Debugging Tools Path (x64)
  set_fact:
    dbgtools_path: "{{ dbgtools_legacy_info.stat.path | default('') if dbgtools_sdk_info is skipped 
                       else dbgtools_sdk_info.stat.path }}"
- debug:
    msg: "{{ 'Debugging Tools found at ' + dbgtools_path | quote if dbgtools_path != ''
             else 'Debugging Tools not found - all tasks will be skipped' }}"
