---
- name: Loading windbg theme
  win_regedit:
    name: Default
    type: binary
    path: HKCU:\SOFTWARE\Microsoft\Windbg\Workspaces
    data: [0x57,0x44,0x57,0x53,0x01,0x00,0x00,0x00,0x33,0x00,0x00,0x00,0x68,0x00,0x5c,0x00,0xf1,0xff,0xff,0xff,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x90,0x01,0x00,0x00,0x00,0x00,0x00,0xee,0x03,0x02,0x01,0x31,0x43,0x00,
  0x6f,0x00,0x6e,0x00,0x73,0x00,0x6f,0x00,0x6c,0x00,0x61,0x00,0x73,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0e,0x00,0x02,0x00,0x10,0x00,0x04,0x00,0x00,
  0x00,0xa0,0x00,0x00,0x00,0x00,0x00,0x0f,0x00,0x02,0x00,0x10,0x00,0x04,0x00,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x0a,0x00,
  0x00,0x00,0x10,0x00,0x04,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3d,0x00,0x00,0x00,0x10,0x00,0x04,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x00,0x10,0x00,0x04,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3c,0x00,0x00,0x00,
  0x10,0x00,0x04,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3f,0x00,0x00,0x00,0x10,0x00,0x04,0x00,0x01,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x12,0x00,0x00,0x00,0x10,0x00,0x04,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xff,0x02,0x00,0x10,0x00,
  0x04,0x00,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0x02,0x00,0x10,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x08,0xff,0x02,0x00,0x10,0x00,0x04,0x00,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x09,0xff,0x02,0x00,0x10,0x00,0x04,0x00,
  0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x44,0x00,0x00,0x00,0x10,0x00,0x04,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
  0x00,0x03,0x00,0x10,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x01,0x00,0x70,0x02,0x68,0x02,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0xff,
  0xff,0xff,0x0f,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x08,
  0x00,0x00,0x00,0x0b,0x01,0x00,0x00,0xc4,0x02,0x00,0x00,0x9b,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0xca,0x00,0x00,0x00,0x84,0x00,0x00,
  0x00,0x86,0x03,0x00,0x00,0x14,0x02,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0a,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0b,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0d,0x00,0x00,0x00,0x01,
  0x00,0x00,0x00,0x01,0x00,0x00,0x00,0xba,0x00,0x00,0x00,0xc2,0x00,0x00,0x00,0x76,0x03,0x00,0x00,0x04,0x02,0x00,0x00,0x03,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x10,0x00,0x08,0x00,0x02,0x00,0x00,
  0x00,0xc0,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x38,0x00,0x2c,0x00,0x2c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,
  0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xbc,0x00,0x00,0x00,0x77,0x00,0x00,0x00,0x99,
  0x05,0x00,0x00,0xc5,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x03,0x00,0x78,0x00,0x6e,0x00,0x07,0x00,0x00,0x00,0x01,0x00,
  0x00,0x00,0x64,0x00,0x00,0x00,0x14,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0xff,0xff,0xff,0x0f,0x04,0x01,0x00,0x00,0x1d,0x04,0x00,
  0x00,0xc7,0x00,0x00,0x00,0xa7,0x05,0x00,0x00,0xa9,0x03,0x00,0x00,0x07,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,
  0xca,0x00,0x00,0x00,0x84,0x00,0x00,0x00,0x86,0x03,0x00,0x00,0x14,0x02,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0xff,0xff,0xff,0x0f,0xff,0xff,0xff,0x0f,0xff,0xff,0xff,0x0f,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x03,0x00,0x80,0x00,0x74,0x00,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x64,0x00,0x00,
  0x00,0x14,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x40,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0xcd,0x04,0x00,0x00,0xdf,0x02,0x00,0x00,0x06,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x0b,
  0x01,0x00,0x00,0xc4,0x02,0x00,0x00,0x9b,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x80,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x0f,0x00,0x00,0x00,0x00,0xcd,0xff,0xff,
  0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x03,0x00,0x10,0x00,0x04,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x45,0x00,0x00,0x00,0x10,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]
  when: dbgtools_path != '' or dbgtools_x86_path != ''
- name: Copy windbg extensions package (x86)
  win_copy:
    src: winext_x86.zip
    dest: "{{ dbgtools_x86_path }}\\"
  when: dbgtools_x86_path != ''
- name: Unpack windbg extensions (x86)
  win_unzip:
    delete_archive: yes
    src: "{{ dbgtools_x86_path }}\\winext_x86.zip"
    dest: "{{ dbgtools_x86_path }}\\winext\\"
  when: dbgtools_x86_path != ''
- name: Copy windbg extensions package (x64)
  win_copy:
    src: winext_x64.zip
    dest: "{{ dbgtools_path }}\\"
  when: dbgtools_path != ''
- name: Unpack windbg extensions (x64)
  win_unzip:
    delete_archive: yes
    src: "{{ dbgtools_path }}\\winext_x64.zip"
    dest: "{{ dbgtools_path }}\\winext\\"
  when: dbgtools_path != ''
- name: Download sosex (x86)
  win_get_url:
    url: http://www.stevestechspot.com/downloads/sosex_32.zip
    dest: "{{ dbgtools_x86_path }}\\"
  when: dbgtools_x86_path != ''
- name: Unpack sosex (x86)
  win_unzip:
    delete_archive: yes
    src: "{{ dbgtools_x86_path }}\\sosex_32.zip"
    dest: "{{ dbgtools_x86_path }}\\winext"
  when: dbgtools_x86_path != ''
- name: Download sosex (x64)
  win_get_url:
    url: http://www.stevestechspot.com/downloads/sosex_64.zip
    dest: "{{ dbgtools_path }}\\"
  when: dbgtools_path != ''
- name: Unpack sosex (x64)
  win_unzip:
    delete_archive: yes
    src: "{{ dbgtools_path }}\\sosex_64.zip"
    dest: "{{ dbgtools_path }}\\winext"
  when: dbgtools_path != ''
- name: Prepare external symbols folder
  win_file: 
    path: "{{ symbols_path }}\\dbg"
    state: directory
  when: dbgtools_path != ''
- name: Prepare private symbols folder
  win_file:
    path: "{{ symbols_path }}\\private"
    state: directory
  when: dbgtools_path != ''
- name: Set _NT_SYMBOL_PATH
  win_environment:
    state: present
    name: _NT_SYMBOL_PATH
    level: machine
    value: "{{ symbols_path}}\\private;SRV*{{ symbols_path }}\\dbg*https://msdl.microsoft.com/download/symbols"
  when: dbgtools_path != ''
- name: Setting PATH variable
  win_path:
    state: present
    scope: machine
    elements: "{{ dbgtools_path }}"
  when: dbgtools_path != ''
- name: Prepare dump context menu registry settings
  template:
    newline_sequence: \r\n
    src: windbg-ia-pde.j2
    dest: "{{ dbgtools_path }}\\windbg-ia-pde.reg"
  when: dbgtools_path != ''
- name: Install dump context menu (by Andrew Richards)
  win_command: reg import "{{ dbgtools_path }}\\windbg-ia-pde.reg"
  when: dbgtools_path != ''
- name: Remove .reg template win_file
  win_file:
    path: "{{ dbgtools_path }}\\windbg-ia-pde.reg"
    state: absent
